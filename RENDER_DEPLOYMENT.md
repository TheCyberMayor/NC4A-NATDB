# Render Deployment Guide

## Prerequisites
- Render account
- Firebase project with service account JSON file
- Repository pushed to GitHub

## Step 1: Prepare Firebase Credentials

### Option A: Using Base64 Encoding (Recommended)
1. Run the encoding script:
   ```bash
   node scripts/encode-firebase.js
   ```
2. Copy the base64 encoded output

### Option B: Using Raw JSON
1. Open `firebase-service-account.json`
2. Copy the entire JSON content (should be one line, no line breaks)

## Step 2: Deploy on Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click "New +" → "Web Service"
3. Connect your GitHub repository
4. Configure the service:
   - **Name**: natdb (or your preferred name)
   - **Environment**: Node
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free

## Step 3: Configure Environment Variables

Add the following environment variables in Render:

### Required Variables:
1. **FIREBASE_SERVICE_ACCOUNT_BASE64**
   - Value: Paste the base64 encoded string from Step 1
   - OR use FIREBASE_SERVICE_ACCOUNT_JSON with raw JSON

2. **NODE_ENV**
   - Value: `production`
   - (Already set in render.yaml)

3. **PORT**
   - Value: `10000`
   - (Already set in render.yaml)

### Optional but Recommended:
4. **CLIENT_URL**
   - Value: Your Render service URL (e.g., `https://natdb.onrender.com`)
   - Used for CORS configuration

5. **JWT_SECRET**
   - Auto-generated by Render (already configured in render.yaml)

6. **RATE_LIMIT_WINDOW_MS**
   - Value: `900000` (15 minutes)
   - (Already set in render.yaml)

7. **RATE_LIMIT_MAX_REQUESTS**
   - Value: `100`
   - (Already set in render.yaml)

## Step 4: Deploy

1. Click "Create Web Service"
2. Wait for the deployment to complete (5-10 minutes)
3. Check the logs for any errors

## Step 5: Verify Deployment

1. Visit your Render URL (e.g., `https://natdb.onrender.com`)
2. Fill out the form
3. Try submitting the form
4. Check Render logs for any errors:
   - Go to your service dashboard
   - Click "Logs" tab
   - Look for error messages

## Troubleshooting

### Issue: Form submission not working

**Check 1: Firebase Configuration**
- Go to Render logs
- Look for: `Firebase Admin SDK initialized for production`
- If you see an error, check your FIREBASE_SERVICE_ACCOUNT_BASE64 variable

**Check 2: Network Errors**
- Open browser console (F12)
- Check Network tab when submitting
- Look for failed requests to `/api/officers`
- Check the response status and error message

**Check 3: CORS Issues**
- If you see CORS errors in browser console
- Set CLIENT_URL environment variable to your Render URL
- Redeploy the service

**Check 4: Rate Limiting**
- If you get "Too many requests" error
- Wait 15 minutes
- Or adjust RATE_LIMIT_MAX_REQUESTS

### Issue: Firebase not initialized

**Solution:**
1. Verify firebase-service-account.json is valid JSON
2. Re-encode using: `node scripts/encode-firebase.js`
3. Update FIREBASE_SERVICE_ACCOUNT_BASE64 in Render
4. Redeploy

### Issue: 500 Internal Server Error

**Solution:**
1. Check Render logs for detailed error
2. Common causes:
   - Missing environment variables
   - Invalid Firebase credentials
   - Database connection issues

## Monitoring

### Check Application Status
- Visit: `https://your-app.onrender.com/api/health`
- Should return: `{"success": true, "message": "CADETN Database Server is running"}`

### View Logs
- Render Dashboard → Your Service → Logs tab
- Look for:
  - Server startup message
  - Firebase initialization message
  - Request logs
  - Error messages

## Common Commands

### Redeploy
```bash
git push origin master
```
Render will auto-deploy when you push to GitHub

### Manual Redeploy
- Go to Render Dashboard
- Click "Manual Deploy" → "Deploy latest commit"

### View Environment Variables
- Render Dashboard → Your Service → Environment tab

## Security Notes

1. **Never commit** `firebase-service-account.json` to GitHub
2. **Never share** your FIREBASE_SERVICE_ACCOUNT_BASE64 publicly
3. **Rotate credentials** if accidentally exposed
4. **Use strong JWT_SECRET** (auto-generated by Render)

## Support

If issues persist:
1. Check Render logs first
2. Check browser console for client-side errors
3. Verify all environment variables are set correctly
4. Test locally to ensure the app works: `npm start`

## Update Checklist

Before deploying updates:
- [ ] Test locally
- [ ] Commit changes to Git
- [ ] Push to GitHub
- [ ] Monitor Render logs during deployment
- [ ] Test the deployed application
- [ ] Check for errors in browser console
